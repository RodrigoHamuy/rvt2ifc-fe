var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,o=(e,t)=>{for(var s in t||(t={}))a.call(t,s)&&r(e,s,t[s]);if(i)for(var s of i(t))n.call(t,s)&&r(e,s,t[s]);return e},c=(e,i)=>t(e,s(i));import{O as l,V as h,B as d,M as m,g as p,E as u,R as g,a as f,P as v,S as w,W as k,b as E,I as b,c as y,d as P,e as C,D as j,A as D,C as T,f as x,h as I}from"./vendor.13f572cd.js";var M,_,O,F;class L{constructor(e){this.stage=e,this.controls=new l(this.stage.camera,this.stage.renderer.domElement),this.controls.enableDamping=!1,this.controls.minDistance=.1,this.controls.maxDistance=100,this.controls.target.set(0,0,0),this.stage.camera.position.set(0,.4,.7),this.controls.update(),this.stage.onPreTick((()=>{this.controls.update()}))}fitToFrame({obj:e,root:t=!1,direction:s=this.stage.camera.getWorldDirection(new h)}){const i=this.stage.camera,a=(new d).setFromObject(e),n=a.getSize(new h).length(),r=a.getCenter(new h),o=.5*n,c=m.DEG2RAD*i.fov*.5,l=o/Math.tan(c),u=s.clone().multiplyScalar(-l).add(r);t&&(i.far=4*l,i.near=l/500,i.updateProjectionMatrix(),this.controls.maxDistance=2*l,this.controls.minDistance=l/100);const g=this.controls.target.clone(),f=r.clone(),v=i.position.clone(),w=u.clone();this.enableControls(!1);const k={v:0};p.to(k,{v:1,onUpdate:()=>{i.position.lerpVectors(v,w,k.v),this.controls.target.lerpVectors(g,f,k.v),this.controls.update()},onComplete:()=>{this.enableControls(!0)},duration:.5})}enableControls(e){this.controls.enableZoom=e,this.controls.enableKeys=e,this.controls.enablePan=e,this.controls.enableRotate=e}}(_=M||(M={})).pick="pick",_.unpick="unpick";class N{constructor(e,t){this.stage=e,this.ifc=t,this.dispatcher=new u,this.raycaster=new g,this.preselectMat=new f({transparent:!0,opacity:.6,color:16746751,depthTest:!1}),this.raycaster.firstHitOnly=!0}cast(e){const t=this.stage.renderer.domElement.getBoundingClientRect(),s=(e.clientX-t.left)/(t.right-t.left)*2-1,i=-(e.clientY-t.top)/(t.bottom-t.top)*2+1;this.raycaster.setFromCamera({x:s,y:i},this.stage.camera);return this.raycaster.intersectObjects(this.stage.scene.children)}pick(e){const t=this.cast(e)[0];if(t){const e=t.faceIndex,s=t.object,i=s.geometry;this.modelID=s.modelID;const a=this.ifc.getExpressId(i,e),n=this.ifc.createSubset({modelID:this.modelID,ids:[a],material:this.preselectMat,scene:this.stage.scene,removePrevious:!0}),r={native:this.ifc.getItemProperties(this.modelID,a,!1),material:this.ifc.getMaterialsProperties(this.modelID,a,!1),type:this.ifc.getTypeProperties(this.modelID,a,!1),quantity:this.ifc.getPropertySets(this.modelID,a,!1)};this.fire(M.pick,{normal:t.face.normal,object:n,data:r})}else void 0!==this.modelID&&(console.log("unpick"),this.ifc.removeSubset(this.modelID,this.stage.scene,this.preselectMat),this.modelID=void 0,this.fire(M.unpick))}on(e,t){this.dispatcher.addEventListener(e,t)}fire(e,t){this.dispatcher.dispatchEvent({type:e,data:t})}}(F=O||(O={})).tick="tick",F.preTick="preTick",F.postTick="postTick";class S{constructor(){this.dispatcher=new u,this.insertCanvas=e=>{this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",e.prepend(this.renderer.domElement)},this.animate=e=>{this.fire(O.preTick,e),requestAnimationFrame(this.animate),this.fire(O.tick,e),this.renderer.render(this.scene,this.camera),this.fire(O.postTick,e)},this.onWindowResize=()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},this.camera=new v(70,window.innerWidth/window.innerHeight,.01,1e3),this.scene=new w,this.renderer=new k({antialias:!0,logarithmicDepthBuffer:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(11119017,1),window.addEventListener("resize",this.onWindowResize),this.animate(0)}onPreTick(e){this.on(O.preTick,e)}onTick(e){this.on(O.tick,e)}onPostTick(e){this.on(O.postTick,e)}off(e,t){this.dispatcher.removeEventListener(e,t)}on(e,t){this.dispatcher.addEventListener(e,t)}fire(e,t){this.dispatcher.dispatchEvent({type:e,data:t})}}class R{constructor(e){this.stats=new E,document.body.appendChild(this.stats.dom),this.stats.showPanel(0),this.stats.dom.style.removeProperty("left"),this.stats.dom.style.right="0px",e.onPreTick(this.stats.begin),e.onPostTick(this.stats.end)}}const U=new class{constructor(){this.stage=new S,this.ifcLoader=new b,this.onPick=e=>{this.picker.on(M.pick,(t=>{var s;(null==(s=t.data)?void 0:s.data)&&e(t.data.data)}))},this.onUnpick=e=>{this.picker.on(M.unpick,e)},this.insertCanvas=this.stage.insertCanvas,this.loadFile=async e=>{console.log("loading");const t=URL.createObjectURL(e);return this.loadUrl(t)},this.loadUrl=async e=>{var t;this.model&&(null==(t=this.model.parent)||t.remove(this.model)),this.model=await this.ifcLoader.loadAsync(e),this.stage.scene.add(this.model),this.cameraManager.fitToFrame({obj:this.model,root:!0})},this.ifcLoader.ifcManager.setupThreeMeshBVH(y,P,C),this.initLights(),this.cameraManager=new L(this.stage),this.picker=new N(this.stage,this.ifcLoader.ifcManager),new R(this.stage),this.stage.renderer.domElement.addEventListener("dblclick",this.picker.pick.bind(this.picker)),this.picker.on(M.pick,(e=>{this.cameraManager.fitToFrame({obj:e.data.object,direction:e.data.normal.clone().negate()})})),this.picker.on(M.unpick,(()=>{this.cameraManager.fitToFrame({obj:this.model})}))}initLights(){const e=new j(16772863,.8);e.position.set(1,1,1),this.stage.scene.add(e);const t=new j(16777215,.8);t.position.set(-1,.5,-1),this.stage.scene.add(t);const s=new D(16777198,.25);this.stage.scene.add(s)}},W=T.exports.createContext({}),z=({children:e})=>{const[t,s]=T.exports.useState({data:void 0}),i=T.exports.useRef(t);return i.current=t,T.exports.useEffect((()=>{U.onPick((e=>s(c(o({},i.current),{data:e})))),U.onUnpick((()=>{s(c(o({},i.current),{data:void 0}))}))}),[]),x.createElement(W.Provider,{value:c(o({},t),{loadUrl:U.loadUrl,loadFile:U.loadFile,insertCanvas:U.insertCanvas})},e)};var H="_panel_p5mwt_1",B="_ul_p5mwt_14",q="_li_p5mwt_20",A="_value_p5mwt_33";const V=e=>{const t=[["IFC Type",e.constructor.name]];for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(!e[s]){console.log(s,e[s]);continue}"object"==typeof e[s]?e[s].value?t.push([s,e[s].value]):console.log(s,e[s].value):t.push([s,e[s]])}return t},$=()=>{const{data:e}=T.exports.useContext(W);return e&&console.log(e),e?x.createElement("div",{className:H},x.createElement("div",null,x.createElement("b",null,"native")),x.createElement("ul",{className:B},V(e.native).map(((e,t)=>x.createElement("li",{key:t,className:q},x.createElement("div",null,e[0]),x.createElement("div",{className:A},e[1]))))),x.createElement("div",null,x.createElement("b",null,"material")),x.createElement("ul",{className:B},e.material.flatMap((e=>V(e).map(((e,t)=>x.createElement("li",{key:t,className:q},x.createElement("div",null,e[0]),x.createElement("div",{className:A},e[1]))))))),x.createElement("div",null,x.createElement("b",null,"quantity")),x.createElement("ul",{className:B},e.quantity.flatMap(((e,t)=>V(e).map(((e,s)=>x.createElement("li",{key:`${t}${s}`,className:q},x.createElement("div",null,e[0]),x.createElement("div",{className:A},e[1])))))))):x.createElement(x.Fragment,null)};var G="_container_i4mor_1",K="_file_i4mor_9";function X(){const e=T.exports.useRef(void 0),{loadFile:t,loadUrl:s,insertCanvas:i}=T.exports.useContext(W),a=T.exports.useCallback((e=>{const s=e.target.files[0];t(s)}),[]);return T.exports.useEffect((()=>{i(e.current),s("project.ifc")}),[]),x.createElement("div",{className:G,ref:e},x.createElement("input",{className:K,type:"file",name:"ifc-file",accept:"ifc",onChange:a}),x.createElement($,null))}I.render(x.createElement(x.StrictMode,null,x.createElement(z,null,x.createElement(X,null))),document.getElementById("root"));
