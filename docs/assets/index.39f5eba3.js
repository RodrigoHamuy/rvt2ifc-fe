var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,o=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&r(e,s,t[s]);if(i)for(var s of i(t))a.call(t,s)&&r(e,s,t[s]);return e},c=(e,i)=>t(e,s(i));import{O as l,V as h,B as d,M as p,g as m,E as u,R as g,a as f,P as v,S as w,W as k,b,I as y,c as E,d as C,e as j,D as P,A as x,C as T,f as D,h as _}from"./vendor.13f572cd.js";var O,I,M,F;class L{constructor(e){this.stage=e,this.controls=new l(this.stage.camera,this.stage.renderer.domElement),this.controls.enableDamping=!1,this.controls.minDistance=.1,this.controls.maxDistance=100,this.controls.target.set(0,0,0),this.stage.camera.position.set(0,.4,.7),this.controls.update(),this.stage.onPreTick((()=>{this.controls.update()}))}fitToFrame({obj:e,root:t=!1,direction:s=this.stage.camera.getWorldDirection(new h)}){const i=this.stage.camera,n=(new d).setFromObject(e),a=n.getSize(new h).length(),r=n.getCenter(new h),o=.5*a,c=p.DEG2RAD*i.fov*.5,l=o/Math.tan(c),u=s.clone().multiplyScalar(-l).add(r);t&&(i.far=4*l,i.near=l/500,i.updateProjectionMatrix(),this.controls.maxDistance=2*l,this.controls.minDistance=l/100);const g=this.controls.target.clone(),f=r.clone(),v=i.position.clone(),w=u.clone();this.enableControls(!1);const k={v:0};m.to(k,{v:1,onUpdate:()=>{i.position.lerpVectors(v,w,k.v),this.controls.target.lerpVectors(g,f,k.v),this.controls.update()},onComplete:()=>{this.enableControls(!0)},duration:.5})}enableControls(e){this.controls.enableZoom=e,this.controls.enableKeys=e,this.controls.enablePan=e,this.controls.enableRotate=e}}(I=O||(O={})).pick="pick",I.unpick="unpick";class R{constructor(e,t){this.stage=e,this.ifc=t,this.dispatcher=new u,this.raycaster=new g,this.preselectMat=new f({transparent:!0,opacity:.6,color:16746751,depthTest:!1}),this.raycaster.firstHitOnly=!0}cast(e){const t=this.stage.renderer.domElement.getBoundingClientRect(),s=(e.clientX-t.left)/(t.right-t.left)*2-1,i=-(e.clientY-t.top)/(t.bottom-t.top)*2+1;this.raycaster.setFromCamera({x:s,y:i},this.stage.camera);return this.raycaster.intersectObjects(this.stage.scene.children)}pick(e){const t=this.cast(e)[0];if(t){const e=t.faceIndex,s=t.object,i=s.geometry;this.modelID=s.modelID;const n=this.ifc.getExpressId(i,e),a=this.ifc.createSubset({modelID:this.modelID,ids:[n],material:this.preselectMat,scene:this.stage.scene,removePrevious:!0}),r=this.ifc.getItemProperties(this.modelID,n,!1);this.fire(O.pick,{normal:t.face.normal,object:a,data:r})}else void 0!==this.modelID&&(console.log("unpick"),this.ifc.removeSubset(this.modelID,this.stage.scene,this.preselectMat),this.modelID=void 0,this.fire(O.unpick))}on(e,t){this.dispatcher.addEventListener(e,t)}fire(e,t){this.dispatcher.dispatchEvent({type:e,data:t})}}(F=M||(M={})).tick="tick",F.preTick="preTick",F.postTick="postTick";class S{constructor(){this.dispatcher=new u,this.insertCanvas=e=>{this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",e.prepend(this.renderer.domElement)},this.animate=e=>{this.fire(M.preTick,e),requestAnimationFrame(this.animate),this.fire(M.tick,e),this.renderer.render(this.scene,this.camera),this.fire(M.postTick,e)},this.onWindowResize=()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},this.camera=new v(70,window.innerWidth/window.innerHeight,.01,1e3),this.scene=new w,this.renderer=new k({antialias:!0,logarithmicDepthBuffer:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(11119017,1),window.addEventListener("resize",this.onWindowResize),this.animate(0)}onPreTick(e){this.on(M.preTick,e)}onTick(e){this.on(M.tick,e)}onPostTick(e){this.on(M.postTick,e)}off(e,t){this.dispatcher.removeEventListener(e,t)}on(e,t){this.dispatcher.addEventListener(e,t)}fire(e,t){this.dispatcher.dispatchEvent({type:e,data:t})}}class U{constructor(e){this.stats=new b,document.body.appendChild(this.stats.dom),this.stats.showPanel(0),this.stats.dom.style.removeProperty("left"),this.stats.dom.style.right="0px",e.onPreTick(this.stats.begin),e.onPostTick(this.stats.end)}}const W=new class{constructor(){this.stage=new S,this.ifcLoader=new y,this.onPick=e=>{this.picker.on(O.pick,(t=>{var s;(null==(s=t.data)?void 0:s.data)&&e(t.data.data)}))},this.onUnpick=e=>{this.picker.on(O.unpick,e)},this.insertCanvas=this.stage.insertCanvas,this.loadFile=async e=>{console.log("loading");const t=URL.createObjectURL(e);return this.loadUrl(t)},this.loadUrl=async e=>{var t;this.model&&(null==(t=this.model.parent)||t.remove(this.model)),this.model=await this.ifcLoader.loadAsync(e),this.stage.scene.add(this.model),this.cameraManager.fitToFrame({obj:this.model,root:!0})},this.ifcLoader.ifcManager.setupThreeMeshBVH(E,C,j),this.initLights(),this.cameraManager=new L(this.stage),this.picker=new R(this.stage,this.ifcLoader.ifcManager),new U(this.stage),this.stage.renderer.domElement.addEventListener("dblclick",this.picker.pick.bind(this.picker)),this.picker.on(O.pick,(e=>{this.cameraManager.fitToFrame({obj:e.data.object,direction:e.data.normal.clone().negate()})})),this.picker.on(O.unpick,(()=>{this.cameraManager.fitToFrame({obj:this.model})}))}initLights(){const e=new P(16772863,.8);e.position.set(1,1,1),this.stage.scene.add(e);const t=new P(16777215,.8);t.position.set(-1,.5,-1),this.stage.scene.add(t);const s=new x(16777198,.25);this.stage.scene.add(s)}},z=T.exports.createContext({}),H=({children:e})=>{const[t,s]=T.exports.useState({data:void 0}),i=T.exports.useRef(t);return i.current=t,T.exports.useEffect((()=>{W.onPick((e=>s(c(o({},i.current),{data:e})))),W.onUnpick((()=>{s(c(o({},i.current),{data:void 0}))}))}),[]),D.createElement(z.Provider,{value:c(o({},t),{loadUrl:W.loadUrl,loadFile:W.loadFile,insertCanvas:W.insertCanvas})},e)};var N="_panel_1ra1q_1",q="_ul_1ra1q_13",B="_li_1ra1q_19",A="_value_1ra1q_28";const V=()=>{const{data:e}=T.exports.useContext(z);return e&&console.log(e),e?D.createElement("div",{className:N},D.createElement("ul",{className:q},(e=>{const t=[["IFC Type",e.constructor.name]];for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(!e[s]){console.log(s,e[s]);continue}"object"==typeof e[s]?e[s].value?t.push([s,e[s].value]):console.log(s,e[s].value):t.push([s,e[s]])}return t})(e).map(((e,t)=>D.createElement("li",{key:t,className:B},D.createElement("div",null,e[0]),D.createElement("div",{className:A},e[1])))))):D.createElement(D.Fragment,null)};var G="_container_i4mor_1",K="_file_i4mor_9";function X(){const e=T.exports.useRef(void 0),{loadFile:t,loadUrl:s,insertCanvas:i}=T.exports.useContext(z),n=T.exports.useCallback((e=>{const s=e.target.files[0];t(s)}),[]);return T.exports.useEffect((()=>{i(e.current),s("project.ifc")}),[]),D.createElement("div",{className:G,ref:e},D.createElement("input",{className:K,type:"file",name:"ifc-file",accept:"ifc",onChange:n}),D.createElement(V,null))}_.render(D.createElement(D.StrictMode,null,D.createElement(H,null,D.createElement(X,null))),document.getElementById("root"));
