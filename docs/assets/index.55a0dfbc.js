var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,o=(e,t)=>{for(var s in t||(t={}))a.call(t,s)&&n(e,s,t[s]);if(i)for(var s of i(t))r.call(t,s)&&n(e,s,t[s]);return e},c=(e,i)=>t(e,s(i));import{O as l,V as h,B as d,M as m,g as p,E as u,R as g,a as f,P as v,S as y,W as b,b as k,I as w,c as E,d as I,e as x,D,A as P,C as L,f as M,h as T}from"./vendor.e4eab59b.js";var j,_,C,S;class F{constructor(e){this.stage=e,this.controls=new l(this.stage.camera,this.stage.renderer.domElement),this.controls.enableDamping=!1,this.controls.minDistance=.1,this.controls.maxDistance=100,this.controls.target.set(0,0,0),this.stage.camera.position.set(0,.4,.7),this.controls.update(),this.stage.onPreTick((()=>{this.controls.update()}))}fitToFrame({obj:e,root:t=!1,direction:s=this.stage.camera.getWorldDirection(new h)}){const i=this.stage.camera,a=(new d).setFromObject(e),r=a.getSize(new h).length(),n=a.getCenter(new h),o=.5*r,c=m.DEG2RAD*i.fov*.5,l=o/Math.tan(c),u=s.clone().multiplyScalar(-l).add(n);t&&(i.far=4*l,i.near=l/500,i.updateProjectionMatrix(),this.controls.maxDistance=2*l,this.controls.minDistance=l/100);const g=this.controls.target.clone(),f=n.clone(),v=i.position.clone(),y=u.clone();this.enableControls(!1);const b={v:0};p.to(b,{v:1,onUpdate:()=>{i.position.lerpVectors(v,y,b.v),this.controls.target.lerpVectors(g,f,b.v),this.controls.update()},onComplete:()=>{this.enableControls(!0)},duration:.5})}enableControls(e){this.controls.enableZoom=e,this.controls.enableKeys=e,this.controls.enablePan=e,this.controls.enableRotate=e}}(_=j||(j={})).pick="pick",_.unpick="unpick";class O{constructor(e,t){this.stage=e,this.ifc=t,this.dispatcher=new u,this.raycaster=new g,this.preselectMat=new f({transparent:!0,opacity:.6,color:16746751,depthTest:!1}),this.unpick=()=>{void 0!==this.modelID&&(console.log("unpick"),this.ifc.removeSubset(this.modelID,this.stage.scene,this.preselectMat),this.modelID=void 0,this.expressID=void 0,this.fire(j.unpick))},this.raycaster.firstHitOnly=!0,globalThis.createSubset=this.createSubset.bind(this)}cast(e){const t=this.stage.renderer.domElement.getBoundingClientRect(),s=(e.clientX-t.left)/(t.right-t.left)*2-1,i=-(e.clientY-t.top)/(t.bottom-t.top)*2+1;this.raycaster.setFromCamera({x:s,y:i},this.stage.camera);return this.raycaster.intersectObjects(this.stage.scene.children)}pick(e){const t=this.cast(e)[0];if(t){const e=t.faceIndex,s=t.object,i=s.geometry,a=this.ifc.getExpressId(i,e);if(a===this.expressID)return;this.createSubset(s.modelID,a,t.face.normal)}else this.unpick()}createSubset(e,t,s=new h(.3,.3,.3).normalize()){const i={native:this.ifc.getItemProperties(e,t,!0),material:this.ifc.getMaterialsProperties(e,t,!0),type:this.ifc.getTypeProperties(e,t,!0),quantity:this.ifc.getPropertySets(e,t,!0)};console.log(i),this.modelID=e,this.expressID=t;const a=this.ifc.createSubset({modelID:this.modelID,ids:[this.expressID],material:this.preselectMat,scene:this.stage.scene,removePrevious:!0});a&&this.fire(j.pick,{normal:s,object:a,data:i})}on(e,t){this.dispatcher.addEventListener(e,t)}fire(e,t){this.dispatcher.dispatchEvent({type:e,data:t})}}(S=C||(C={})).tick="tick",S.preTick="preTick",S.postTick="postTick";class A{constructor(){this.dispatcher=new u,this.insertCanvas=e=>{this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",e.prepend(this.renderer.domElement)},this.animate=e=>{this.fire(C.preTick,e),requestAnimationFrame(this.animate),this.fire(C.tick,e),this.renderer.render(this.scene,this.camera),this.fire(C.postTick,e)},this.onWindowResize=()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},this.camera=new v(70,window.innerWidth/window.innerHeight,.01,1e3),this.scene=new y,this.renderer=new b({antialias:!0,logarithmicDepthBuffer:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(11119017,1),window.addEventListener("resize",this.onWindowResize),this.animate(0)}onPreTick(e){this.on(C.preTick,e)}onTick(e){this.on(C.tick,e)}onPostTick(e){this.on(C.postTick,e)}off(e,t){this.dispatcher.removeEventListener(e,t)}on(e,t){this.dispatcher.addEventListener(e,t)}fire(e,t){this.dispatcher.dispatchEvent({type:e,data:t})}}class N{constructor(e){this.stats=new k,document.body.appendChild(this.stats.dom),this.stats.showPanel(0),this.stats.dom.style.removeProperty("left"),this.stats.dom.style.right="0px",e.onPreTick(this.stats.begin),e.onPostTick(this.stats.end)}}const R=new class{constructor(){this.stage=new A,this.ifcLoader=new w,this.onPick=e=>{this.picker.on(j.pick,(t=>{var s;(null==(s=t.data)?void 0:s.data)&&e(t.data.data)}))},this.onUnpick=e=>{this.picker.on(j.unpick,e)},this.insertCanvas=this.stage.insertCanvas,this.loadFile=async e=>{console.log("loading");const t=URL.createObjectURL(e);return this.loadUrl(t)},this.loadUrl=async e=>{var t;this.model&&(this.picker.unpick(),null==(t=this.model.parent)||t.remove(this.model)),this.model=await this.ifcLoader.loadAsync(e),console.log(this.model.modelID),this.stage.scene.add(this.model),this.cameraManager.fitToFrame({obj:this.model,root:!0})},this.ifcLoader.ifcManager.setupThreeMeshBVH(E,I,x),this.initLights(),this.cameraManager=new F(this.stage),this.picker=new O(this.stage,this.ifcLoader.ifcManager),this.ifcApi=this.ifcLoader.ifcManager.ifcAPI,new N(this.stage),this.stage.renderer.domElement.addEventListener("dblclick",this.picker.pick.bind(this.picker)),this.picker.on(j.pick,(e=>{this.cameraManager.fitToFrame({obj:e.data.object,direction:e.data.normal.clone().negate()})})),this.picker.on(j.unpick,(()=>{this.cameraManager.fitToFrame({obj:this.model})}))}getAll(){const e=this.GetAllItems(this.model.modelID).filter((e=>e.customExtractedData.material.length));console.log(e);const t=e=>new Promise((t=>setTimeout(t,100*e)));globalThis.loop=async()=>{for(const s of e)await t(3),globalThis.createSubset(this.model.modelID,s.expressID)}}initLights(){const e=new D(16772863,.8);e.position.set(1,1,1),this.stage.scene.add(e);const t=new D(16777215,.8);t.position.set(-1,.5,-1),this.stage.scene.add(t);const s=new P(16777198,.25);this.stage.scene.add(s)}GetAllItems(e){const t=[],s=this.ifcApi.GetAllLines(e);return this.getAllItemsFromLines(e,s,t),t}getAllItemsFromLines(e,t,s){for(let a=1;a<=t.size();a++)try{this.saveProperties(e,t,s,a)}catch(i){console.log(i)}}saveProperties(e,t,s,i){const a=t.get(i),r=this.ifcApi.GetLine(e,a);r.type=r.__proto__.constructor.name,["IfcWallStandardCase","IfcSlab"].includes(r.type)&&(s.push(r),r.customExtractedData={native:this.ifcLoader.ifcManager.getItemProperties(e,r.expressID,!0),material:this.ifcLoader.ifcManager.getMaterialsProperties(e,r.expressID,!0),type:this.ifcLoader.ifcManager.getTypeProperties(e,r.expressID,!0),quantity:this.ifcLoader.ifcManager.getPropertySets(e,r.expressID,!0)})}},U=L.exports.createContext({}),W=({children:e})=>{const[t,s]=L.exports.useState({data:void 0}),i=L.exports.useRef(t);return i.current=t,L.exports.useEffect((()=>{R.onPick((e=>s(c(o({},i.current),{data:e})))),R.onUnpick((()=>{s(c(o({},i.current),{data:void 0}))}))}),[]),M.createElement(U.Provider,{value:c(o({},t),{loadUrl:R.loadUrl,loadFile:R.loadFile,insertCanvas:R.insertCanvas})},e)};var z="_panel_28jd4_1",H="_header_28jd4_14",V="_ul_28jd4_20",B="_li_28jd4_26",G="_value_28jd4_39";const q=()=>{const{data:e}=L.exports.useContext(U);if(!e)return M.createElement(M.Fragment,null);const t=[["Name",e.native.Name.value],["IFC type",e.native.constructor.name],["Object type",e.native.ObjectType.value]],s=e.quantity.find((e=>"Dimensions"===e.Name.value));if(s){const e=s.HasProperties.map((e=>[e.Name.value,e.NominalValue.value]));console.log(...e);for(const t of e)"Area"===t[0]&&(t[1]=Math.round(1e4*t[1])/1e4),"Length"===t[0]&&(t[1]=Math.round(1e4*t[1])),"Volume"===t[0]&&(t[1]=Math.round(1e3*t[1])/1e3);t.push(...e)}if(e.material.length){let s;if(e.material[0].ForLayerSet&&(s=e.material[0].ForLayerSet.MaterialLayers),e.material[0].MaterialLayers?s=e.material[0].MaterialLayers:e.material[0].Name&&t.push(["layer name",e.material[0].Name.value]),s)for(let e=0;e<s.length;e++){const i=s[e];t.push([`layer ${e} name`,i.Material.Name.value]),t.push([`layer ${e} thickness`,i.LayerThickness.value])}}return M.createElement("div",{className:z},M.createElement("div",{className:H},"extracted"),M.createElement("ul",{className:V},t.map(((e,t)=>M.createElement("li",{key:t,className:B},M.createElement("div",null,e[0]),M.createElement("div",{className:G},e[1]))))))};var $="_container_i4mor_1",K="_file_i4mor_9";function X(){const e=L.exports.useRef(void 0),{loadFile:t,loadUrl:s,insertCanvas:i}=L.exports.useContext(U),a=L.exports.useCallback((e=>{const s=e.target.files[0];t(s)}),[]);return L.exports.useEffect((()=>{i(e.current),s("project.ifc")}),[]),M.createElement("div",{className:$,ref:e},M.createElement("input",{className:K,type:"file",name:"ifc-file",accept:"ifc",onChange:a}),M.createElement(q,null))}T.render(M.createElement(M.StrictMode,null,M.createElement(W,null,M.createElement(X,null))),document.getElementById("root"));
